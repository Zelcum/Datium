<!DOCTYPE html>
<html class="dark" lang="es">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Formulario Sistema</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
        rel="stylesheet" />
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#137fec",
                        "background-light": "#f6f7f8",
                        "background-dark": "#101922",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                },
            },
        }
    </script>
    <style>
        body {
            background: transparent;
        }

        ::-webkit-scrollbar {
            width: 4px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        .dark ::-webkit-scrollbar-thumb {
            background: #374151;
        }
    </style>
</head>

<body class="font-display text-[#111418] dark:text-gray-200 p-1">

    <div class="flex flex-col h-full">
        <!-- Tabs Header -->
        <div class="flex gap-2 mb-6 border-b border-gray-200 dark:border-gray-700">
            <button onclick="switchTab('general')" id="tab-general"
                class="tab-btn active-tab pb-3 px-4 text-sm font-bold border-b-2 border-primary text-primary transition-all flex items-center gap-2">
                <span class="material-symbols-outlined">info</span> General
            </button>
            <button onclick="switchTab('security')" id="tab-security"
                class="tab-btn pb-3 px-4 text-sm font-bold border-b-2 border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 transition-all flex items-center gap-2">
                <span class="material-symbols-outlined">security</span> Seguridad
            </button>
            <button onclick="switchTab('schema')" id="tab-schema"
                class="tab-btn pb-3 px-4 text-sm font-bold border-b-2 border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 transition-all flex items-center gap-2">
                <span class="material-symbols-outlined">dataset</span> Campos
            </button>
        </div>

        <!-- Tab Contents -->
        <div class="relative flex-1">

            <!-- General Tab -->
            <div id="content-general" class="tab-content grid grid-cols-1 gap-6 animate-fade-in">
                <!-- Drag & Drop Zone -->
                <div class="w-full">
                    <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2 ml-1">Logo del
                        Sistema</label>
                    <div id="dropZone"
                        class="group relative w-full h-32 rounded-2xl border-2 border-dashed border-gray-300 dark:border-gray-600 bg-gray-50/50 dark:bg-gray-800/30 flex flex-col items-center justify-center cursor-pointer hover:border-primary hover:bg-primary/5 dark:hover:border-primary transition-all duration-300 overflow-hidden backdrop-blur-sm">
                        <input type="file" id="fileInput" class="hidden" accept="image/*">
                        <input type="hidden" id="newSystemImage">

                        <div id="uploadPlaceholder"
                            class="flex flex-col items-center text-center p-4 transition-opacity duration-300">
                            <div
                                class="h-10 w-10 bg-white dark:bg-gray-700 rounded-full shadow-lg flex items-center justify-center mb-2 group-hover:scale-110 transition-transform duration-300">
                                <span class="material-symbols-outlined text-xl text-primary">cloud_upload</span>
                            </div>
                            <p class="text-xs font-bold text-gray-600 dark:text-gray-300">Arrastra tu logo</p>
                        </div>

                        <img id="imagePreview" src="" class="absolute inset-0 w-full h-full object-contain p-2 hidden"
                            alt="Preview">

                        <button id="removeImageBtn" type="button"
                            class="absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full shadow-lg hidden hover:bg-red-600 transition-colors z-10">
                            <span class="material-symbols-outlined text-sm">close</span>
                        </button>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2 ml-1">Nombre</label>
                    <div class="relative">
                        <span
                            class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 material-symbols-outlined">badge</span>
                        <input type="text" id="newSystemName"
                            class="w-full pl-12 pr-4 py-3 rounded-xl border-gray-200 dark:border-gray-700 bg-white/50 dark:bg-gray-800/50 text-[#111418] dark:text-white font-medium focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all shadow-sm backdrop-blur-sm"
                            placeholder="Ej. CRM Ventas">
                    </div>
                </div>

                <div>
                    <label
                        class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2 ml-1">Descripción</label>
                    <div class="relative">
                        <span class="absolute left-4 top-4 text-gray-400 material-symbols-outlined">description</span>
                        <textarea id="newSystemDesc"
                            class="w-full h-24 pl-12 pr-4 py-3 rounded-xl border-gray-200 dark:border-gray-700 bg-white/50 dark:bg-gray-800/50 text-[#111418] dark:text-white font-medium focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all shadow-sm resize-none backdrop-blur-sm"
                            placeholder="Propósito del sistema..."></textarea>
                    </div>
                </div>
            </div>

            <!-- Security Tab -->
            <div id="content-security" class="tab-content hidden grid grid-cols-1 gap-6 animate-fade-in">
                <div
                    class="bg-blue-50 dark:bg-blue-900/10 p-4 rounded-xl border border-blue-100 dark:border-blue-900/30">
                    <div class="flex items-start gap-3">
                        <span class="material-symbols-outlined text-primary mt-1">info</span>
                        <p class="text-sm text-gray-600 dark:text-gray-300">
                            Define quién puede acceder a este sistema. Puedes cambiar esto más tarde.
                        </p>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2 ml-1">Modo de
                        Acceso</label>
                    <div class="relative">
                        <span
                            class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 material-symbols-outlined">lock</span>
                        <select id="securityMode" onchange="toggleSecurityFields()"
                            class="w-full pl-12 pr-4 py-3 rounded-xl border-gray-200 dark:border-gray-700 bg-white/50 dark:bg-gray-800/50 text-[#111418] dark:text-white font-medium focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all shadow-sm backdrop-blur-sm appearance-none cursor-pointer">
                            <option value="none">Público (Sin contraseña)</option>
                            <option value="general">Contraseña General</option>
                            <!-- <option value="individual">Usuarios Individuales</option> Future update -->
                        </select>
                        <span
                            class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 material-symbols-outlined pointer-events-none">expand_more</span>
                    </div>
                </div>

                <div id="generalPasswordContainer" class="hidden">
                    <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2 ml-1">Contraseña de
                        Acceso</label>
                    <div class="relative">
                        <span
                            class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 material-symbols-outlined">key</span>
                        <input type="password" id="generalPassword"
                            class="w-full pl-12 pr-4 py-3 rounded-xl border-gray-200 dark:border-gray-700 bg-white/50 dark:bg-gray-800/50 text-[#111418] dark:text-white font-medium focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all shadow-sm backdrop-blur-sm"
                            placeholder="Ingresa una contraseña segura">
                    </div>
                </div>
            </div>

            <!-- Schema Tab -->
            <div id="content-schema" class="tab-content hidden flex flex-col gap-4 animate-fade-in h-[380px]">
                <div
                    class="bg-purple-50 dark:bg-purple-900/10 p-4 rounded-xl border border-purple-100 dark:border-purple-900/30 flex justify-between items-center">
                    <div class="flex items-start gap-3">
                        <span class="material-symbols-outlined text-purple-500 mt-1">schema</span>
                        <div>
                            <p class="text-sm font-bold text-purple-900 dark:text-purple-200">Estructura Inicial</p>
                            <p class="text-xs text-purple-700 dark:text-purple-300">
                                Define los campos básicos de tu sistema.
                            </p>
                        </div>
                    </div>
                    <button type="button" onclick="addFieldRow()"
                        class="px-3 py-1.5 bg-purple-100 dark:bg-purple-900/40 text-purple-600 dark:text-purple-300 rounded-lg text-xs font-bold hover:bg-purple-200 dark:hover:bg-purple-900/60 transition-colors flex items-center gap-1">
                        <span class="material-symbols-outlined text-base">add</span> Campo
                    </button>
                </div>

                <div class="flex-1 overflow-y-auto pr-2 space-y-3" id="fieldsContainer">
                    <!-- Field Rows will be added here -->
                    <div class="text-center py-10 text-gray-400" id="noFieldsMsg">
                        <p>No has agregado campos.</p>
                    </div>
                </div>
            </div>

        </div>

        <div class="flex justify-end gap-3 pt-6 mt-auto border-t border-gray-100 dark:border-gray-800/50">
            <button type="button" onclick="cancelform()"
                class="px-6 py-2.5 rounded-xl border border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-300 font-bold hover:bg-gray-50 dark:hover:bg-gray-800 transition-all">
                Cancelar
            </button>
            <button type="button" onclick="submitForm()" id="btnSave"
                class="px-8 py-2.5 rounded-xl bg-gradient-to-r from-primary to-blue-600 text-white font-bold shadow-lg shadow-primary/30 hover:shadow-primary/50 hover:-translate-y-0.5 transition-all flex items-center gap-2">
                <span class="material-symbols-outlined">check_circle</span>
                Guardar
            </button>
        </div>
    </div>

    <!-- Template for Field Row -->
    <template id="fieldRowTemplate">
        <div
            class="field-row group flex items-start gap-2 bg-white dark:bg-gray-800 p-2 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm transition-all hover:border-primary/50">
            <div class="flex-1">
                <input type="text"
                    class="field-name w-full px-3 py-2 rounded-lg border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50 text-xs font-medium focus:ring-1 focus:ring-primary focus:border-primary"
                    placeholder="Nombre (ej. Teléfono)">
            </div>
            <div class="w-1/3">
                <select
                    class="field-type w-full px-2 py-2 rounded-lg border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50 text-xs font-medium focus:ring-1 focus:ring-primary focus:border-primary">
                    <option value="text">Texto</option>
                    <option value="number">Número</option>
                    <option value="date">Fecha</option>
                    <option value="boolean">Si/No</option>
                </select>
            </div>
            <div class="flex items-center justify-center pt-2">
                <label class="flex items-center gap-2 cursor-pointer" title="Requerido">
                    <input type="checkbox"
                        class="field-required rounded border-gray-300 text-primary focus:ring-primary h-4 w-4">
                </label>
            </div>
            <button type="button" onclick="removeField(this)"
                class="p-1.5 text-gray-400 hover:text-red-500 transition-colors">
                <span class="material-symbols-outlined text-lg">delete</span>
            </button>
        </div>
    </template>

    <script src="js/auth.js"></script>
    <script src="js/app.js"></script>
    <script src="js/system_form.js"></script>
    <script>
        // Initialize theme based on parent or local storage
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    </script>
</body>

</html>